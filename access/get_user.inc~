<?php
$fila = null;
require('./dbhandlers/dbcon.inc');

if (isset($_GET['id'])) {
	consulta("select * from users where login='".$_GET['id']."'");

	if (mysqli_num_rows($result) === 1){
		$fila = mysqli_fetch_assoc($result);
		LimpiaResultados($fila);
	} else {
		mysqli_free_result($result);
		mysqli_close($db);

		$URL="./users.php"; 
		header ("Location: $URL"); 
	}
} else if (isset($_GET['list'])) {
	$consulta = "select login, nombre, apellidos from users where ".$_GET['field']." like '%".$_GET['text']."%' order by ".$_GET['order'];
	if ($_GET['reverse'] == "true") $consulta = $consulta." desc";
	consulta($consulta);

	$resultado = mysqli_query($db, $consulta);
	CompruebaErrorMySQL('Error realizando la consulta', $db);
	assert($resultado !== false);
	if (mysqli_num_rows($resultado) > 0){
		while ($fila = mysqli_fetch_assoc($resultado)){
			LimpiaResultados($fila);
			echo '<p><a href="./user_profile.php?id='.$fila['login'].'">'.
					$fila['nombre'].' '.$fila['apellidos'].'</a></p>';
		}
	} else {
		require('../lang/'.$_GET['lang'].'.inc');
		echo $tusers_nofound;
	}

	mysqli_free_result($resultado);
	mysqli_close($db);
}
?>
